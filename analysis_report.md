# 攻撃型聖杯 銘柄選定ロジック差異分析レポート

## 概要

元の聖杯ダッシュボード（Excel）と作成したWebシステムで、攻撃型ポートフォリオの銘柄が全く異なる問題についてMECE分析を行いました。

### 銘柄比較

| 順位 | 元の聖杯（Excel） | 作成したシステム |
|------|------------------|-----------------|
| 1 | SNDK (Sandisk) +433% | BRK-B (Berkshire) +3.9% |
| 2 | WDC (Western Digital) +171% | MSFT (Microsoft) -2.3% |
| 3 | WBD (Warner Bros) +162% | CSCO (Cisco) +10.2% |
| 4 | MU (Micron) +137% | AAPL (Apple) +24.2% |
| 5 | ALB (Albemarle) +116% | GOOGL (Alphabet) +84.9% |

---

## MECE分析：原因の分類

### 1. 銘柄ユニバース（対象銘柄の範囲）

| 要素 | 元の聖杯 | 作成したシステム | 影響度 |
|------|---------|-----------------|--------|
| **対象銘柄数** | S&P1500全体（約1500銘柄） | S&P500上位50銘柄のみ | **極めて高い** |
| **銘柄フィルター** | 複数指数（Dow30, NASDAQ100, Russell2000, SP100, SP400, SP600）から選定可能 | 大型株50銘柄に限定 | **極めて高い** |
| **SNDK, WDC, WBD, MU, ALB** | S&P1500に含まれる | SP500_TOP_SYMBOLSに**含まれていない** | **決定的** |

**結論**: 元の聖杯で選定された銘柄（SNDK, WDC, WBD, MU, ALB）は、作成したシステムの銘柄ユニバースに含まれていないため、そもそも選定対象外となっている。

---

### 2. モメンタム計算ロジック

| 要素 | 元の聖杯 | 作成したシステム | 影響度 |
|------|---------|-----------------|--------|
| **モメンタム期間** | 6ヶ月リターン（月次データ） | 6ヶ月リターン（日次データ） | 中程度 |
| **計算式** | (現在価格 - 6ヶ月前価格) / 6ヶ月前価格 | 同様の計算式 | 低い |
| **追加指標** | 1ヶ月、3ヶ月、12ヶ月、52週高値乖離、13612Wスコア、ExpReg90_R2 | なし | 中程度 |
| **モメンタムスコア** | 複合スコア（複数期間の加重平均の可能性） | 単純6ヶ月リターン | 中程度 |

---

### 3. リスク計算ロジック

| 要素 | 元の聖杯 | 作成したシステム | 影響度 |
|------|---------|-----------------|--------|
| **リスク指標** | MaxRange_90日 / 終値（90日間の最大レンジ比率） | 日次リターンの標準偏差（年率換算ボラティリティ） | **高い** |
| **リスク計算式** | MaxRangePct_90日 = MaxRange_90日 / 終値 | sqrt(variance * 252) * 100 | **高い** |
| **ウェイト計算** | リスク逆数ウェイト（1/リスク） | リスク逆数ウェイト（1/ボラティリティ） | 低い |

---

### 4. 追加フィルター条件

| 要素 | 元の聖杯 | 作成したシステム | 影響度 |
|------|---------|-----------------|--------|
| **流動性フィルター** | 売買代金_1か月平均（最低閾値あり？） | なし | 中程度 |
| **取引開始日** | 記録あり（エントリー日を管理） | なし | 低い |
| **SEIHAI列** | True/Falseフラグ（聖杯対象銘柄） | なし | 不明 |
| **Active列** | True/Falseフラグ（アクティブ銘柄） | なし | 不明 |

---

### 5. データソース

| 要素 | 元の聖杯 | 作成したシステム | 影響度 |
|------|---------|-----------------|--------|
| **データ取得元** | 不明（Google Finance / 専用API？） | Yahoo Finance API | 中程度 |
| **データ更新頻度** | 月次更新 | リアルタイム（API呼び出し時） | 低い |
| **株価データ** | 終値ベース | 調整後終値ベース | 低い |

---

## 根本原因の特定

### 主要原因（決定的）

**1. 銘柄ユニバースの違い**

元の聖杯はS&P1500全体（約1500銘柄）を対象としているのに対し、作成したシステムはS&P500の上位50銘柄のみを対象としています。

元の聖杯で選定された上位5銘柄：
- **SNDK** (Sandisk): 作成したシステムの銘柄リストに**含まれていない**
- **WDC** (Western Digital): 作成したシステムの銘柄リストに**含まれていない**
- **WBD** (Warner Bros): 作成したシステムの銘柄リストに**含まれていない**
- **MU** (Micron): 作成したシステムの銘柄リストに**含まれていない**
- **ALB** (Albemarle): 作成したシステムの銘柄リストに**含まれていない**

これが銘柄が全く異なる**最大の原因**です。

### 副次的原因

**2. リスク計算方法の違い**
- 元の聖杯: 90日間の最大レンジ比率
- 作成したシステム: 年率換算ボラティリティ

**3. モメンタム計算の複雑さ**
- 元の聖杯: 複数期間のモメンタム、52週高値乖離、回帰分析スコアなど複合的
- 作成したシステム: 単純な6ヶ月リターンのみ

---

## 修正提案

### 優先度1（必須）
銘柄ユニバースをS&P1500全体に拡張する。少なくとも以下の銘柄を追加：
- SNDK, WDC, WBD, MU, ALB, TER, APP, STX, FIX, LRCX など

### 優先度2（推奨）
リスク計算を90日間最大レンジ比率に変更する：
```
リスク = (90日間の最高値 - 90日間の最安値) / 現在終値
```

### 優先度3（オプション）
モメンタムスコアを複合指標に変更：
- 1ヶ月、3ヶ月、6ヶ月、12ヶ月リターンの加重平均
- 52週高値からの乖離率を考慮

---

## 結論

銘柄が全く異なる**最大の原因は銘柄ユニバースの違い**です。元の聖杯はS&P1500全体から選定しているため、高モメンタムの中小型株（SNDK, WDC, WBDなど）が選ばれていますが、作成したシステムはS&P500上位50銘柄に限定しているため、これらの銘柄が選定対象外となっています。

銘柄ユニバースを拡張することで、元の聖杯と同様の銘柄選定が可能になります。
