# Project TODO

## 機能追加（1,2,3）

- [x] 実際の市場データとの連携（Yahoo Finance API）
- [x] 具体的な銘柄リストの表示（攻撃型・防御型）
- [x] 履歴保存とアラート機能

## 詳細タスク

### 1. 市場データ連携
- [x] データベーススキーマ作成（市場データ、シグナル履歴）
- [x] 市場データ取得サービス実装
- [x] シグナル計算ロジック実装
- [x] tRPCルーター実装

### 2. 銘柄リスト表示
- [x] S&P500銘柄データ取得
- [x] モメンタム計算ロジック実装
- [x] ボラティリティ計算ロジック実装
- [x] 銘柄選定・ウェイト計算ロジック実装
- [x] 銘柄リスト表示UI実装

### 3. 履歴・アラート機能
- [x] シグナル履歴テーブル作成
- [x] 履歴保存ロジック実装
- [x] 履歴表示UI実装
- [x] 市場環境変化時の通知機能実装

### インフラ
- [x] フルスタック構成へのアップグレード
- [x] データベースマイグレーション
- [x] フロントエンドUI更新
- [x] テスト実装

## 月次パフォーマンス一覧表機能

- [x] 月次パフォーマンス計算ロジック実装
- [x] 攻撃型聖杯の月次リターン・ドローダウン計算
- [x] 防御型聖杯の月次リターン・ドローダウン計算
- [x] パフォーマンス一覧表UIの作成

## ナビゲーション改善

- [x] トップページからパフォーマンス一覧への分かりやすいリンク追加

## 銘柄選定ロジック分析

- [x] 元の聖杯ダッシュボードの選定ロジック分析
- [x] 作成したシステムの選定ロジック確認
- [x] MECE分析で原因特定
- [x] 分析結果レポート作成

## 銘柄選定ロジック修正

- [x] 元の聖杯から銘柄ユニバースを抽出
- [x] 銘柄ユニバースをS&P1500に拡張
- [x] リスク計算ゐ90日最大レンジ比率に変更
- [x] モメンタム計算を6ヶ月リターンに統一
- [x] ウェイト計算をリスク逆数に修正
- [x] 銘柄と投資比率の一致確認（元のExcelデータで検証済み）

## バックテスト・分散数設定機能

- [x] バックテスト用の過去データ取得ロジック実装
- [x] バックテストAPIエンドポイント作成
- [x] バックテストUI（日付選択、結果表示）作成
- [x] 分散数設定のAPIパラメータ追加
- [x] 分散数設定UI（スライダー/入力）作成
- [x] テストと動作確認

## 日付選択機能の改善

- [x] 日付ピッカーUIの実装（カレンダー形式）
- [x] 任意の日付でのバックテストAPI対応
- [x] テストと動作確認

## データソース比較検証

- [x] 元のExcelデータから月次パフォーマンスを抽出
- [x] Yahoo Finance APIデータで同期間のパフォーマンスを計算
- [x] 両データソースの結果を比較分析
- [x] 検証結果レポート作成

## リスク計算式の特定

- [x] Excelの全カラムとデータ構造を詳細分析
- [x] リスク計算式の逆算と検証
- [x] 分析結果レポート作成

## データソース影響分析

- [x] 両データソースでポートフォリオを構築
- [x] 月次リターンとドローダウンを計算
- [x] 影響度の定量分析と可視化
- [x] 分析結果レポート作成

## 運用コスト分析と削減提案

- [x] 現在のシステム構成とAPI呼び出しパターンを分析
- [x] コスト発生要因の特定と定量化
- [x] コスト削減のための提案を作成

## キャッシュ実装

- [x] サーバーサイドキャッシュモジュールの作成
- [x] marketData.tsへのキャッシュ統合
- [x] portfolioSelection.tsへのキャッシュ統合
- [x] backtestService.tsへのキャッシュ統合
- [x] クライアントサイドキャッシュの最適化（React Query設定）
- [x] テストと動作確認

## 攻撃型聖杯モデルの検証

- [x] 現在の実装ロジックを確認
- [x] これまでの分析結果との照合
- [x] 元の聖杯との一致度を定量評価
- [x] 検証結果レポート作成

## 防御型聖杯モデルの検証

- [x] 元のExcelから防御型聖杯のロジックを抽出
- [x] 現在の実装ロジックを確認
- [x] 元のExcelデータで検証テストを実施
- [x] 一致度を定量評価
- [x] 検証結果レポート作成

## 防御型聖杯ロジックの修正

- [x] ソート基準を「リスク昇順」から「6か月モメンタム降順」に変更
- [x] 選定数をデフォルト5銘柄に固定
- [x] テストと動作確認
- [x] 元のExcelデータで検証（完全一致確認）

## 防御型聖杯のウェイト計算修正

- [x] 元のExcelから防御型聖杯のウェイト計算ロジックを解析
- [x] ウェイト計算をリスク逆数ウェイト（傾斜配分）に修正
- [x] テストと検証（元のExcelと完全一致確認）

## システム構成図とGitHubアップロード

- [x] システム構成図を作成（Mermaid形式 + PNG）
- [x] README.mdを更新してドキュメントを整備
- [x] LICENSEファイルを追加
- [x] GitHubアップロードの準備完了

## CI/CDパイプライン構築

- [x] GitHub ActionsのCI/CDワークフローを作成
- [x] PRテンプレート、Issueテンプレートを追加
- [x] CONTRIBUTING.mdを追加
- [x] GitHubリポジトリを作成
- [x] コードをプッシュ

## GitHub Actionsワークフロー修正

- [x] CIワークフローを修正（Secrets不要に）
- [x] Deployワークフローを修正（手動トリガーのみ）
- [x] GitHubにプッシュして動作確認（CI #11 成功）

## 攻撃型・防御型聖杯の最終検証

- [x] 元のExcelデータから攻撃型・防御型のロジックを抽出
- [x] 現在の実装ロジックを確認
- [x] 元のExcelデータで検証テストを実施
- [x] 一致度を定量評価（攻撃型100%、防御型100%）
- [x] 検証結果レポート作成
## 攻撃型聖杯の動的選定への変更

- [x] S&P500全銘柄（497銘柄）のリストを取得・管理するロジックを実装
- [x] 動的選定ロジックをportfolioSelection.tsに実装
- [x] テストと動作確認（UIで動的選定結果を確認）

## 攻撃型聖杯の動的選定ロジック検証（MECE分析）

- [x] 元のExcelデータから攻撃型聖杯の銘柄選定・投資割合を抽出
- [x] 現在の動的選定ロジックの詳細を確認
- [x] MECEフレームワークで検証項目を整理
- [x] 過去の複数時点で銘柄選定・投資割合を比較検証
- [x] 検証結果レポートを作成・報告

## リスク計算式の精綻化

- [x] 元のExcelデータからリスク計算式を詳細に解析
- [x] リスク計算式の候補を特定し検証
- [x] 正確なリスク計算式を実装（日次リターンの標準偏差 × √252）
- [x] テストと検証（平均一致率: 89.8%）
- [x] GitHubにプッシュして報告

## 防御型ポートフォリオの表示問題修正

- [x] 防御型ポートフォリオの表示問題を調査（キャッシュの問題であることを確認）
- [x] 問題の原因を特定し修正（サーバー再起動で解決）
- [x] テストと検証（APIで正常に4銘柄表示を確認）
- [x] GitHubにプッシュして報告

## ETFデータ取得問題の調査・修正

- [x] 各ETFのデータ取得状況を詳細に調査（API制限が原因）
- [x] 問題の原因を特定し修正（フォールバック処理を追加）
- [x] テストと検証（防御型5銘柄表示を確認）
- [x] GitHubにプッシュして報告

## 攻撃型ポートフォリオのフォールバック処理追加

- [x] 攻撃型ポートフォリオの現在のロジックを確認
- [x] フォールバック処理を実装（NVDA, META, AMZN等10銘柄）
- [x] ユニットテストを作成・実行（5テスト全てパス）
- [x] GitHubにプッシュして報告

## API制限時のフォールバック通知機能

- [x] バックエンドにフォールバック状態を返すロジックを追加
- [x] フロントエンドに通知UIを実装（アンバー色の警告バナー）
- [x] テストと検証（UIでフォールバック通知表示を確認）
- [x] GitHubにプッシュして報告

## データ更新頻度の最適化（月1回リバランス対応）

- [x] 要件を整理しMECEな実装案を確定
- [x] バックエンドのキャッシュ・スケジュール設定を変更（TTL延長、手動更新API追加）
- [x] 全ユーザー向け手動更新機能を実装（ホーム、ポートフォリオページにボタン追加）
- [x] テストと検証（ユニットテスト10件パス、API動作確認済み）
- [x] GitHubにプッシュして報告
